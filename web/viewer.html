<!DOCTYPE html> 

<html lang="it"> 

<head> 

  <meta charset="utf-8" /> 

  <title>Viewer PDF Minimal</title> 

  <meta name="viewport" content="width=device-width, initial-scale=1.0" /> 

  <style> 

    html, body { 

      margin: 0; 

      padding: 0; 

      background: #f5f5f5; 

      font-family: sans-serif; 

    } 

    #pdf-container { 

      width: 100%; 

      max-width: 900px; 

      margin: 20px auto; 

      padding: 10px; 

      position: relative; 

    } 

    .page-wrapper { 

      position: relative; 

      margin-bottom: 20px; 

      box-shadow: 0 0 8px rgba(0,0,0,0.1); 

    } 

    canvas { 

      display: block; 

      width: 100%; 

      height: auto; 

    } 

    .link-layer { 

      position: absolute; 

      top: 0; 

      left: 0; 

      pointer-events: none; 

      z-index: 10; 

    } 

    .link-layer a { 

      position: absolute; 

      display: block; 

      pointer-events: auto; 

      background: transparent; /* metti rgba(0,0,255,0.1) per debug */ 

    } 

  </style> 

</head> 

<body> 

 

  <div id="pdf-container"></div> 

 

  <script type="module"> 

    import * as pdfjsLib from '../build/pdf.mjs'; 

 

    pdfjsLib.GlobalWorkerOptions.workerSrc = '../build/pdf.worker.mjs'; 

 

    // Cambia qui il path del PDF: 

    const url = '../web/compressed.tracemonkey-pldi-09.pdf.pdf'; 

 

    const container = document.getElementById('pdf-container'); 

 

    function renderPage(pdf, pageNum) { 

      pdf.getPage(pageNum).then(page => { 

        const viewport = page.getViewport({ scale: 1.5 }); 

 

        // Crea un wrapper per canvas + link layer 

        const pageWrapper = document.createElement('div'); 

        pageWrapper.className = 'page-wrapper'; 

 

        const canvas = document.createElement('canvas'); 

        const context = canvas.getContext('2d'); 

        canvas.height = viewport.height; 

        canvas.width = viewport.width; 

 

        pageWrapper.appendChild(canvas); 

        container.appendChild(pageWrapper); 

 

        page.render({ 

          canvasContext: context, 

          viewport: viewport 

        }).promise.then(() => { 

          page.getAnnotations().then(annotations => { 

            const linkLayer = document.createElement('div'); 

            linkLayer.className = 'link-layer'; 

            linkLayer.style.width = canvas.width + 'px'; 

            linkLayer.style.height = canvas.height + 'px'; 

 

            pageWrapper.appendChild(linkLayer); 

 

            annotations.forEach(annotation => { 

              if (annotation.subtype === 'Link') { 

                const rect = pdfjsLib.Util.normalizeRect(annotation.rect); 

                const transform = viewport.transform; 

 

                const x = transform[0] * rect[0] + transform[2] * rect[1] + transform[4]; 

                const y = transform[1] * rect[1] + transform[3] * rect[1] + transform[5]; 

                const width = (rect[2] - rect[0]) * transform[0]; 

                const height = (rect[3] - rect[1]) * transform[3]; 

 

                const link = document.createElement('a'); 

                link.style.left = `${x}px`; 

                link.style.top = `${y - height}px`; 

                link.style.width = `${width}px`; 

                link.style.height = `${height}px`; 

 

                if (annotation.url) { 

                  link.href = annotation.url; 

                  link.target = '_blank'; 

                } else if (annotation.dest) { 

                  link.href = `#page=${annotation.dest[0].num || annotation.dest}`; 

                } 

 

                linkLayer.appendChild(link); 

              } 

            }); 

          }); 

        }); 

      }); 

    } 

 

    pdfjsLib.getDocument(url).promise.then(pdf => { 

      console.log(`PDF caricato: ${pdf.numPages} pagine`); 

 

      // Render tutte le pagine 

      for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) { 

        renderPage(pdf, pageNum); 

      } 

 

      // Supporta #page=N 

      window.addEventListener('hashchange', () => { 

        const match = location.hash.match(/#page=(\d+)/); 

        if (match) { 

          const targetPage = parseInt(match[1], 10); 

          if (targetPage >= 1 && targetPage <= pdf.numPages) { 

            const targetWrapper = container.children[targetPage - 1]; 

            if (targetWrapper) { 

              targetWrapper.scrollIntoView({ behavior: 'smooth' }); 

            } 

          } 

        } 

      }); 

 

      // Se arrivo giÃ  con #page=N 

      const initialMatch = location.hash.match(/#page=(\d+)/); 

      if (initialMatch) { 

        const targetPage = parseInt(initialMatch[1], 10); 

        setTimeout(() => { 

          const targetWrapper = container.children[targetPage - 1]; 

          if (targetWrapper) { 

            targetWrapper.scrollIntoView({ behavior: 'smooth' }); 

          } 

        }, 1000); 

      } 

    }); 

  </script> 

 

</body> 

</html> 
