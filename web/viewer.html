<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>PDF Minimal Viewer - Tutte le pagine con link interni</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      background: #f0f0f0;
    }
    #pdf-container {
      width: 100%;
      max-width: 800px;
      margin: 0 auto;
      padding: 10px;
    }
    canvas {
      display: block;
      margin: 20px auto;
      border: 1px solid #ccc;
    }
  </style>
</head>
<body>
  <div id="pdf-container"></div>

  <script type="module">
    import * as pdfjsLib from '../build/pdf.mjs';

    pdfjsLib.GlobalWorkerOptions.workerSrc = '../build/pdf.worker.mjs';

    const url = '../web/compressed.tracemonkey-pldi-09.pdf';
    const container = document.getElementById('pdf-container');

     function renderPage(pdf, pageNum) { 

  pdf.getPage(pageNum).then(page => { 

    const viewport = page.getViewport({ scale: 1.5 }); 

 

    const canvas = document.createElement('canvas'); 

    const context = canvas.getContext('2d'); 

    canvas.height = viewport.height; 

    canvas.width = viewport.width; 

 

    container.appendChild(canvas); 

 

    // Imposta la posizione relativa per overlay 

    container.style.position = 'relative'; 

 

    page.render({ 

      canvasContext: context, 

      viewport: viewport 

    }).promise.then(() => { 

      page.getAnnotations().then(annotations => { 

        const linkLayer = document.createElement('div'); 

        linkLayer.style.position = 'absolute'; 

        linkLayer.style.top = canvas.offsetTop + 'px'; 

        linkLayer.style.left = canvas.offsetLeft + 'px'; 

        linkLayer.style.width = canvas.width + 'px'; 

        linkLayer.style.height = canvas.height + 'px'; 

        linkLayer.style.pointerEvents = 'none'; 

        linkLayer.style.zIndex = 10; 

 

        container.appendChild(linkLayer); 

 

        annotations.forEach(annotation => { 

          if (annotation.subtype === 'Link') { 

            const rect = pdfjsLib.Util.normalizeRect(annotation.rect); 

            const view = viewport.transform; 

            const x = view[0] * rect[0] + view[2] * rect[1] + view[4]; 

            const y = view[1] * rect[1] + view[3] * rect[1] + view[5]; 

            const width = (rect[2] - rect[0]) * view[0]; 

            const height = (rect[3] - rect[1]) * view[3]; 

 

            const link = document.createElement('a'); 

            link.style.position = 'absolute'; 

            link.style.left = `${x}px`; 

            link.style.top = `${y - height}px`; // corregge Y 

            link.style.width = `${width}px`; 

            link.style.height = `${height}px`; 

            link.style.display = 'block'; 

            link.style.pointerEvents = 'auto'; 

            link.style.background = 'transparent'; 

 

            if (annotation.url) { 

              link.href = annotation.url; 

              link.target = '_blank'; 

            } else if (annotation.dest) { 

              link.href = `#page=${annotation.dest[0].num || annotation.dest}`; 

            } 

 

            linkLayer.appendChild(link); 

          } 

        }); 

      }); 

    }); 

  }); 

} 
  </script>
</body>
</html>
